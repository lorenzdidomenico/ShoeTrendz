<template>
  <div>
    <h1>Carrello</h1>
    <h2>Contenuto del Carrello</h2>
    <ul>
      <li v-for="(scarpa, index) in scarpeNelCarrello" :key="index">
        <!-- Verifica se 'scarpa' è definita e se ha le proprietà 'product' e 'price' -->
        <template v-if="scarpa && scarpa.product && scarpa.price">
          {{ scarpa.product }} - {{ scarpa.price }} €
        </template>
      </li>
    </ul>
    <p v-if="scarpeNelCarrello.length === 0">
      Nessun prodotto aggiunto al carrello
    </p>
    <hr v-if="scarpeNelCarrello.length > 0" class="total-amount" />

    <!-- Mostra il totale iniziale -->
    <p style="text-align: right">
      <strong>Totale:</strong> {{ totaleSenzaSpedizione }} €
    </p>

    <!-- Mostra il pulsante "Calcola Totale" solo se non è stato calcolato il totale con spedizione -->
    <button
      v-if="!mostraTotaleConSpedizione"
      @click="calcolaTotale"
      class="checkout-button"
    >
      Calcola Totale
    </button>

    <!-- Mostra il totale con spedizione solo se è stato calcolato -->
    <p v-if="mostraTotaleConSpedizione" style="text-align: right">
      <strong>Totale con spedizione:</strong> {{ totaleConSpedizione }} €
    </p>

    <!-- Mostra il pulsante "Checkout" solo se è stato calcolato il totale con spedizione -->
    <button
      v-if="mostraTotaleConSpedizione"
      @click="avviaCheckout"
      class="checkout-button"
    >
      Checkout
    </button>

    <h3>Hai un codice sconto?</h3>
    <input v-model="codiceSconto" placeholder="Inserisci il codice sconto" />
    <button @click="applicaSconto" class="sconto-button">Applica Sconto</button>
  </div>
</template>

<script>
import { mapGetters } from "vuex";

export default {
  data() {
    return {
      costoSpedizione: 5, // Imposta il costo della spedizione desiderato
      totaleSenzaSpedizione: 0,
      totaleConSpedizione: 0,
      mostraTotaleConSpedizione: false,
      codiceSconto: "",
      scontoRiscattato: false,
    };
  },
  computed: {
    ...mapGetters(["scarpeNelCarrello"]),
  },
  methods: {
    // Funzione per calcolare l'ammontare totale del carrello
    calcolaTotaleCarrello() {
      let totale = 0;
      this.scarpeNelCarrello.forEach((scarpa) => {
        if (scarpa && scarpa.price) {
          totale += scarpa.price;
        }
      });
      return totale;
    },
    calcolaTotale() {
      // Calcola il totale senza spedizione
      this.totaleSenzaSpedizione = this.calcolaTotaleCarrello();

      // Mostra il totale con il costo di spedizione
      this.totaleConSpedizione = this.totaleSenzaSpedizione + this.costoSpedizione;

      // Ora hai il totale con il costo di spedizione disponibile
      this.mostraTotaleConSpedizione = true;
    },
    avviaCheckout() {
      // Puoi eseguire la logica del checkout qui se necessario

      // Calcola il totale senza spedizione

    },
    applicaSconto() {
  if (!this.scontoRiscattato) {
    if (this.codiceSconto === "LORENZO50") {
      this.totaleConSpedizione = this.totaleConSpedizione * 0.5;
      this.scontoRiscattato = true;
      alert("Codice sconto riscattato correttamente!");
    } else {
      alert("Codice sconto non valido");
    }
  } else {
    alert("Il codice sconto è stato già riscattato.");
  }
},

  },
};
</script>

<style>
.total-amount {
  text-align: right;
  font-size: 1.2rem;
  font-weight: bold;
  margin-top: 20px;

  /* Aggiungi una transizione al cambio di colore */
}

.checkout-button {
  background-color: #007bff;
  /* Colore di sfondo */
  color: #fff;
  /* Colore del testo */
  font-size: 1.2rem;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  float: right;
}

.checkout-button:hover {
  background-color: #0056b3;
  /* Colore di sfondo al passaggio del mouse */
}

.sconto-button {
  background-color: #5dc746;
}
</style>
